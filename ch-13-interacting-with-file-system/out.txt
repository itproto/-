'USE STRICT'
CONST { PIPELINE, TRANSFORM } = REQUIRE('STREAM')
CONST { JOIN } = REQUIRE('PATH')
CONST { CREATEREADSTREAM, CREATEWRITESTREAM  } = REQUIRE('FS')

CONST FILE = JOIN(__DIRNAME, 'OUT.TXT')

CONST CREATEUPPERCASESTREAM = () => {
    RETURN NEW TRANSFORM({
        TRANSFORM(CHUNK, ENCODING, NEXT) {
            CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE()
            NEXT(NULL, UPPERCASED)
        } 
    })
}

PIPELINE(
    CREATEREADSTREAM(__FILENAME),
    CREATEUPPERCASESTREAM(),
    CREATEWRITESTREAM(FILE), 
    ERR => {
        IF (ERR) {
            CONSOLE.ERROR(ERR)
            RETURN
        } ELSE {
            CONSOLE.LOG('FINISHED WRITING FILE')
        }
    }
)